<html>
  <head>
    <title>fshsrobotics - LineFollow</title>
    <link rel="stylesheet" href="static/style.css" type="text/css" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  </head>
  <body>
    <div class="wiki" id="content_view" style="display: block;">
<pre class="rds-code">
<code class="cpp">
#pragma config(Sensor, S1,     cLeft,          sensorI2CCustom)
#pragma config(Sensor, S2,     cRight,         sensorI2CCustom)
#pragma config(Motor,  motorA,          mLeft,         tmotorNXT, PIDControl, encoder)
#pragma config(Motor,  motorB,          mRight,        tmotorNXT, PIDControl, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

/* Line Follow (color sensors)
 * Kris Choy
 * Fort Street High School Robotics
 */

// Include driver
#include "drivers/hitechnic-colour-v2.h"

// Global constants
// Colours
#define LEFT_BLACK_LOW 30
#define LEFT_BLACK_HIGH 100
#define LEFT_WHITE_LOW 100
#define LEFT_WHITE_HIGH 300

#define RIGHT_BLACK_LOW 30
#define RIGHT_BLACK_HIGH 100
#define RIGHT_WHITE_LOW 100
#define RIGHT_WHITE_HIGH 300

// Movement
#define MOTOR_SPEED 40
#define MOTOR_TURN_LARGE 40
#define MOTOR_TURN_SMALL 0

// Macros
#define WITHIN(x, low, high) (((x &lt; high) &amp;&amp; (x &gt;= low)) ? 1 : 0)

// Function declarations
void move(int left, int right);         // change motor speeds of left/right motor
void updateSensors();                   // Update sensor values

// Global variables
// These variables store current RGB values for left and right sensors
// Values range from 0 to 255
int lRed, lGreen, lBlue;
int rRed, rGreen, rBlue;
// Averages RGB values for line follow
// Values range from 0 to 255
int lWhite, rWhite;

// All RobotC programs have a main task function
task main() {
    // Infinite loop
    while(1) {
        // Update values
        updateSensors();

        // Both white
        if (WITHIN(lWhite, LEFT_WHITE_LOW, LEFT_WHITE_HIGH) &amp;&amp; WITHIN(rWhite, RIGHT_WHITE_LOW, RIGHT_WHITE_HIGH)) {
            move(MOTOR_SPEED, MOTOR_SPEED);
        }
        // Both black
        else if (WITHIN(lWhite, LEFT_BLACK_LOW, LEFT_BLACK_HIGH) &amp;&amp; WITHIN(rWhite, RIGHT_BLACK_LOW, RIGHT_BLACK_HIGH)) {
            move(MOTOR_SPEED, MOTOR_SPEED);
        }
        // Left black, right white
        else if (WITHIN(lWhite, LEFT_BLACK_LOW, LEFT_BLACK_HIGH) &amp;&amp; WITHIN(rWhite, RIGHT_WHITE_LOW, RIGHT_WHITE_HIGH)) {
            // Rotate left wheel slow, right wheel fast to turn left
            move(MOTOR_TURN_SMALL, MOTOR_TURN_LARGE);
        }
        // left white, right black
        else if (WITHIN(lWhite, LEFT_WHITE_LOW, LEFT_WHITE_HIGH) &amp;&amp; WITHIN(rWhite, RIGHT_BLACK_LOW, RIGHT_BLACK_HIGH)) {
            // Rotate left wheel fast, right wheel slow to turn right
            move(MOTOR_TURN_SMALL, MOTOR_TURN_LARGE);
        }
    }
}

// Sets the speed of left and right motor
void move(int left, int right) {
    motor[mLeft] = left;
    motor[mRight] = right;
}

// Updates the sensor values and puts values
// into global variables
void updateSensors() {
    HTCS2readRGB(cLeft, lRed, lGreen, lBlue);
    HTCS2readRGB(cRight, rRed, rGreen, rBlue);
    HTCS2readWhite(cLeft, lWhite);
    HTCS2readWhite(cRight, rWhite);
}
</code>
</pre>
    </div>
  </body>
</html>